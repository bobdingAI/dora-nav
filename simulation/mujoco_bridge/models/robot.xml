<!-- MJCF Model for Differential Drive Robot with LiDAR and IMU -->
<!-- Customize this model for your specific robot -->

<mujoco model="differential_drive_robot">
  <compiler angle="radian" coordinate="local"/>

  <option timestep="0.001" gravity="0 0 -9.81" integrator="RK4"/>

  <default>
    <geom friction="1 0.5 0.5" condim="3"/>
    <joint damping="0.1"/>
    <motor ctrllimited="true" ctrlrange="-10 10"/>
  </default>

  <asset>
    <texture name="grid" type="2d" builtin="checker" width="512" height="512"
             rgb1="0.1 0.2 0.3" rgb2="0.2 0.3 0.4"/>
    <material name="grid_mat" texture="grid" texrepeat="10 10"/>
    <material name="robot_mat" rgba="0.8 0.2 0.2 1"/>
    <material name="wheel_mat" rgba="0.1 0.1 0.1 1"/>
    <material name="lidar_mat" rgba="0.2 0.2 0.8 1"/>
  </asset>

  <worldbody>
    <!-- Ground plane -->
    <geom name="ground" type="plane" size="50 50 0.1" material="grid_mat"/>

    <!-- Sample obstacles for LiDAR testing -->
    <body name="wall1" pos="5 0 0.5">
      <geom type="box" size="0.1 3 0.5" rgba="0.5 0.5 0.5 1"/>
    </body>
    <body name="wall2" pos="-5 0 0.5">
      <geom type="box" size="0.1 3 0.5" rgba="0.5 0.5 0.5 1"/>
    </body>
    <body name="wall3" pos="0 5 0.5">
      <geom type="box" size="3 0.1 0.5" rgba="0.5 0.5 0.5 1"/>
    </body>
    <body name="wall4" pos="0 -5 0.5">
      <geom type="box" size="3 0.1 0.5" rgba="0.5 0.5 0.5 1"/>
    </body>

    <!-- Cylindrical obstacles -->
    <body name="pillar1" pos="2 2 0.5">
      <geom type="cylinder" size="0.3 0.5" rgba="0.6 0.4 0.2 1"/>
    </body>
    <body name="pillar2" pos="-2 -2 0.5">
      <geom type="cylinder" size="0.3 0.5" rgba="0.6 0.4 0.2 1"/>
    </body>

    <!-- Robot base (chassis) -->
    <body name="robot_base" pos="0 0 0.15">
      <joint name="robot_x" type="slide" axis="1 0 0"/>
      <joint name="robot_y" type="slide" axis="0 1 0"/>
      <joint name="robot_yaw" type="hinge" axis="0 0 1"/>

      <!-- Main chassis body -->
      <geom name="chassis" type="box" size="0.3 0.2 0.1" material="robot_mat" mass="5"/>

      <!-- IMU is located at robot base center -->
      <!-- Accelerometer sensor -->
      <site name="imu_site" pos="0 0 0" size="0.02"/>

      <!-- Left wheel -->
      <body name="left_wheel" pos="0 0.22 -0.05">
        <joint name="left_wheel_joint" type="hinge" axis="0 1 0"/>
        <geom name="left_wheel_geom" type="cylinder" size="0.1 0.02"
              material="wheel_mat" mass="0.5" euler="1.5708 0 0"/>
      </body>

      <!-- Right wheel -->
      <body name="right_wheel" pos="0 -0.22 -0.05">
        <joint name="right_wheel_joint" type="hinge" axis="0 1 0"/>
        <geom name="right_wheel_geom" type="cylinder" size="0.1 0.02"
              material="wheel_mat" mass="0.5" euler="1.5708 0 0"/>
      </body>

      <!-- Caster wheel (front) -->
      <body name="caster" pos="0.2 0 -0.08">
        <geom name="caster_geom" type="sphere" size="0.02" mass="0.1"/>
      </body>

      <!-- LiDAR sensor mount -->
      <body name="lidar" pos="0 0 0.15">
        <geom name="lidar_body" type="cylinder" size="0.05 0.03"
              material="lidar_mat" mass="0.3"/>
        <!-- LiDAR scan origin -->
        <site name="lidar_site" pos="0 0 0.03" size="0.01"/>
      </body>
    </body>
  </worldbody>

  <!-- Actuators for differential drive -->
  <actuator>
    <velocity name="left_motor" joint="left_wheel_joint" kv="10"/>
    <velocity name="right_motor" joint="right_wheel_joint" kv="10"/>
  </actuator>

  <!-- Sensors -->
  <sensor>
    <!-- Accelerometer at IMU site -->
    <accelerometer name="imu_accel" site="imu_site"/>
    <!-- Gyroscope at IMU site -->
    <gyro name="imu_gyro" site="imu_site"/>
    <!-- Wheel encoders -->
    <jointvel name="left_wheel_vel" joint="left_wheel_joint"/>
    <jointvel name="right_wheel_vel" joint="right_wheel_joint"/>
  </sensor>
</mujoco>
