<!-- Combined: Differential Drive Robot in Warehouse Environment -->
<mujoco model="robot_in_warehouse">
  <compiler angle="radian" coordinate="local"/>

  <option timestep="0.001" gravity="0 0 -9.81" integrator="RK4"/>

  <default>
    <geom friction="1 0.5 0.5" condim="3"/>
    <joint damping="0.1"/>
    <motor ctrllimited="true" ctrlrange="-10 10"/>
  </default>

  <asset>
    <texture name="floor_tex" type="2d" builtin="checker" width="512" height="512"
             rgb1="0.9 0.9 0.9" rgb2="0.8 0.8 0.8"/>
    <material name="floor_mat" texture="floor_tex" texrepeat="20 20"/>
    <material name="wall_mat" rgba="0.7 0.7 0.7 1"/>
    <material name="shelf_mat" rgba="0.4 0.3 0.2 1"/>
    <material name="box_mat" rgba="0.6 0.4 0.2 1"/>
    <material name="robot_mat" rgba="0.8 0.2 0.2 1"/>
    <material name="wheel_mat" rgba="0.1 0.1 0.1 1"/>
    <material name="lidar_mat" rgba="0.2 0.2 0.8 1"/>
  </asset>

  <worldbody>
    <!-- Floor -->
    <geom name="floor" type="plane" size="25 25 0.1" material="floor_mat"/>

    <!-- Outer walls -->
    <body name="north_wall" pos="0 20 1.5">
      <geom type="box" size="20 0.1 1.5" material="wall_mat"/>
    </body>
    <body name="south_wall" pos="0 -20 1.5">
      <geom type="box" size="20 0.1 1.5" material="wall_mat"/>
    </body>
    <body name="east_wall" pos="20 0 1.5">
      <geom type="box" size="0.1 20 1.5" material="wall_mat"/>
    </body>
    <body name="west_wall" pos="-20 0 1.5">
      <geom type="box" size="0.1 20 1.5" material="wall_mat"/>
    </body>

    <!-- Shelf row 1 -->
    <body name="shelf_1_1" pos="-10 5 1">
      <geom type="box" size="2 0.3 1" material="shelf_mat"/>
    </body>
    <body name="shelf_1_2" pos="-10 -5 1">
      <geom type="box" size="2 0.3 1" material="shelf_mat"/>
    </body>

    <!-- Shelf row 2 -->
    <body name="shelf_2_1" pos="0 5 1">
      <geom type="box" size="2 0.3 1" material="shelf_mat"/>
    </body>
    <body name="shelf_2_2" pos="0 -5 1">
      <geom type="box" size="2 0.3 1" material="shelf_mat"/>
    </body>

    <!-- Shelf row 3 -->
    <body name="shelf_3_1" pos="10 5 1">
      <geom type="box" size="2 0.3 1" material="shelf_mat"/>
    </body>
    <body name="shelf_3_2" pos="10 -5 1">
      <geom type="box" size="2 0.3 1" material="shelf_mat"/>
    </body>

    <!-- Random boxes -->
    <body name="box1" pos="-5 10 0.25">
      <geom type="box" size="0.3 0.3 0.25" material="box_mat"/>
    </body>
    <body name="box2" pos="5 -10 0.25">
      <geom type="box" size="0.3 0.3 0.25" material="box_mat"/>
    </body>
    <body name="box3" pos="15 15 0.25">
      <geom type="box" size="0.3 0.3 0.25" material="box_mat"/>
    </body>

    <!-- Pillars -->
    <body name="pillar_1" pos="-15 15 1.5">
      <geom type="cylinder" size="0.2 1.5" rgba="0.5 0.5 0.5 1"/>
    </body>
    <body name="pillar_2" pos="15 15 1.5">
      <geom type="cylinder" size="0.2 1.5" rgba="0.5 0.5 0.5 1"/>
    </body>
    <body name="pillar_3" pos="-15 -15 1.5">
      <geom type="cylinder" size="0.2 1.5" rgba="0.5 0.5 0.5 1"/>
    </body>
    <body name="pillar_4" pos="15 -15 1.5">
      <geom type="cylinder" size="0.2 1.5" rgba="0.5 0.5 0.5 1"/>
    </body>

    <!-- Robot base (chassis) -->
    <body name="robot_base" pos="0 0 0.15">
      <joint name="robot_x" type="slide" axis="1 0 0"/>
      <joint name="robot_y" type="slide" axis="0 1 0"/>
      <joint name="robot_yaw" type="hinge" axis="0 0 1"/>

      <geom name="chassis" type="box" size="0.3 0.2 0.1" material="robot_mat" mass="5"/>

      <site name="imu_site" pos="0 0 0" size="0.02"/>

      <!-- Left wheel -->
      <body name="left_wheel" pos="0 0.22 -0.05">
        <joint name="left_wheel_joint" type="hinge" axis="0 1 0"/>
        <geom name="left_wheel_geom" type="cylinder" size="0.1 0.02"
              material="wheel_mat" mass="0.5" euler="1.5708 0 0"/>
      </body>

      <!-- Right wheel -->
      <body name="right_wheel" pos="0 -0.22 -0.05">
        <joint name="right_wheel_joint" type="hinge" axis="0 1 0"/>
        <geom name="right_wheel_geom" type="cylinder" size="0.1 0.02"
              material="wheel_mat" mass="0.5" euler="1.5708 0 0"/>
      </body>

      <!-- Caster wheel -->
      <body name="caster" pos="0.2 0 -0.08">
        <geom name="caster_geom" type="sphere" size="0.02" mass="0.1"/>
      </body>

      <!-- LiDAR sensor mount -->
      <body name="lidar" pos="0 0 0.15">
        <geom name="lidar_body" type="cylinder" size="0.05 0.03"
              material="lidar_mat" mass="0.3"/>
        <site name="lidar_site" pos="0 0 0.03" size="0.01"/>
      </body>
    </body>
  </worldbody>

  <actuator>
    <velocity name="left_motor" joint="left_wheel_joint" kv="10"/>
    <velocity name="right_motor" joint="right_wheel_joint" kv="10"/>
  </actuator>

  <!-- Start robot at path origin facing path direction (128 deg = 2.234 rad) -->
  <keyframe>
    <key name="path_start" qpos="-0.21 0.28 2.234 0 0"/>
  </keyframe>

  <sensor>
    <accelerometer name="imu_accel" site="imu_site"/>
    <gyro name="imu_gyro" site="imu_site"/>
    <jointvel name="left_wheel_vel" joint="left_wheel_joint"/>
    <jointvel name="right_wheel_vel" joint="right_wheel_joint"/>
  </sensor>
</mujoco>
