# Mujoco Simulation Dataflow for Mapping
# Use this to build maps in simulation before running localization
#
# Usage:
#   dora up
#   dora start simulation/mujoco_bridge/dataflow_mapping_sim.yml

nodes:
  # Mujoco simulation bridge
  - id: mujoco_sim
    custom:
      source: simulation/mujoco_bridge/build/mujoco_sim_bridge
      inputs:
        tick: dora/timer/millis/10
      outputs:
        - pointcloud
        - imu_msg
        - ground_truth_pose
    envs:
      MUJOCO_MODEL_PATH: simulation/mujoco_bridge/models/robot.xml
      SIM_TIMESTEP: "0.001"
      LIDAR_RAYS: "1080"
      LIDAR_RANGE: "100.0"
      POINTCLOUD_RATE: "10"
      IMU_RATE: "20"

  # NDT Mapping node
  - id: ndt_mapping
    custom:
      source: mapping/ndt_mapping/build/ndt_mapping
      inputs:
        pointcloud: mujoco_sim/pointcloud

  # Visualization
  - id: rerun
    custom:
      source: rerun/build/to_rerun
      inputs:
        pointcloud: mujoco_sim/pointcloud
